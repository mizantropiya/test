<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildberries Analytics Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        :root {
            --primary: #2c6b2f;
            --primary-light: #e6f4ea;
            --secondary: #4a86e8;
            --secondary-light: #e8f0fe;
            --danger: #dc3545;
            --danger-light: #f8d7da;
            --warning: #ffc107;
            --warning-light: #fff3cd;
            --success: #28a745;
            --success-light: #d4edda;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border: #dee2e6;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .dashboard-header {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border-left: 6px solid var(--primary);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo-icon {
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo-text h1 {
            color: var(--primary);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .logo-text p {
            color: var(--gray);
            font-size: 14px;
        }

        .account-info {
            background: var(--primary-light);
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid rgba(44, 107, 47, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            border: 1px solid var(--border);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .stat-icon.total { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-icon.products { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-icon.orders { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-icon.turnover { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

        .stat-title {
            font-size: 13px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 4px;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 24px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Products Table */
        .table-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .section-title h2 {
            color: var(--dark);
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .section-title p {
            color: var(--gray);
            font-size: 14px;
        }

        .controls-panel {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            min-width: 250px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 16px 10px 40px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(44, 107, 47, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, #3a8a3e 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(44, 107, 47, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #5a96e8 100%);
            color: white;
        }

        .btn-outline {
            background: white;
            color: var(--dark);
            border: 1px solid var(--border);
        }

        .btn-outline:hover {
            background: var(--light);
            border-color: var(--gray);
        }

        /* Table */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        thead {
            background: var(--light);
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
            font-size: 14px;
            white-space: nowrap;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }

        tbody tr:hover {
            background: var(--light);
        }

        .stock-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            min-width: 60px;
            text-align: center;
            display: inline-block;
        }

        .stock-critical { background: var(--danger-light); color: var(--danger); }
        .stock-low { background: var(--warning-light); color: #856404; }
        .stock-normal { background: var(--success-light); color: var(--success); }
        .stock-high { background: var(--primary-light); color: var(--primary); }

        .turnover-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
            display: inline-block;
        }

        .turnover-fast { background: linear-gradient(135deg, #28a745, #20c997); color: white; }
        .turnover-medium { background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; }
        .turnover-slow { background: linear-gradient(135deg, #dc3545, #e83e8c); color: white; }

        .days-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            min-width: 70px;
            text-align: center;
            display: inline-block;
        }

        .days-urgent { background: linear-gradient(135deg, #dc3545, #e83e8c); color: white; }
        .days-warning { background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; }
        .days-good { background: linear-gradient(135deg, #28a745, #20c997); color: white; }
        .days-excess { background: linear-gradient(135deg, #6c757d, #495057); color: white; }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
        }

        .card-header .badge {
            background: var(--primary-light);
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .warehouse-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .warehouse-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            background: var(--light);
            border-radius: 10px;
            border-left: 4px solid var(--secondary);
        }

        .warehouse-info .name {
            font-weight: 600;
            font-size: 14px;
        }

        .warehouse-info .days {
            font-size: 12px;
            color: var(--gray);
            margin-top: 4px;
        }

        .warehouse-stats {
            text-align: right;
        }

        .warehouse-stats .stock {
            font-weight: 700;
            font-size: 16px;
            color: var(--dark);
        }

        .warehouse-stats .trend {
            font-size: 12px;
            color: var(--gray);
            margin-top: 2px;
        }

        .trend.up { color: var(--success); }
        .trend.down { color: var(--danger); }

        /* Action Card */
        .action-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
        }

        .action-card h3 {
            font-size: 20px;
            margin-bottom: 12px;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            text-align: center;
            color: var(--gray);
            font-size: 14px;
            padding: 20px;
            border-top: 1px solid var(--border);
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--gray-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Error State */
        .error-state {
            text-align: center;
            padding: 40px 20px;
            background: var(--danger-light);
            border-radius: 12px;
            margin: 20px 0;
            color: var(--danger);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-top {
                flex-direction: column;
                align-items: stretch;
            }
            
            .account-info {
                align-self: flex-start;
            }
            
            .controls-panel {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã...</h3>
        <p id="loadingText">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–∞—à–µ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É –¥–∞–Ω–Ω—ã—Ö</p>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="header-top">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Wildberries Analytics</h1>
                        <p>–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–∞—à–µ–π Google –¢–∞–±–ª–∏—Ü—ã</p>
                    </div>
                </div>
                
                <div class="account-info">
                    <i class="fas fa-store"></i>
                    <div>
                        <div>–ö–∞–±–∏–Ω–µ—Ç –ø—Ä–æ–¥–∞–≤—Ü–∞ Wildberries</div>
                        <div id="accountStats">–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"</div>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon total">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div>
                            <div class="stat-title">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div>
                            <div class="stat-value" id="totalProducts">0</div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon products">
                            <i class="fas fa-box"></i>
                        </div>
                        <div>
                            <div class="stat-title">–û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫</div>
                            <div class="stat-value" id="totalStock">0 —à—Ç</div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon orders">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div>
                            <div class="stat-title">–ó–∞–∫–∞–∑–æ–≤ –∑–∞ 30 –¥–Ω.</div>
                            <div class="stat-value" id="totalOrders">0</div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon turnover">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <div class="stat-title">–°—Ä. –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å</div>
                            <div class="stat-value" id="avgTurnover">0 –¥–Ω.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Products Table -->
            <div class="table-section">
                <div class="section-header">
                    <div class="section-title">
                        <h2><i class="fas fa-boxes"></i> –û—Å—Ç–∞—Ç–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                        <p>–°—É–º–º–∞—Ä–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –≤—Å–µ—Ö —Å–∫–ª–∞–¥–∞—Ö Wildberries</p>
                    </div>
                    
                    <div class="controls-panel">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞—Ä—Ç–∏–∫—É–ª—É...">
                        </div>
                        <button class="btn btn-primary" id="loadDataBtn">
                            <i class="fas fa-download"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                        </button>
                    </div>
                </div>

                <div id="errorState" class="error-state" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
                    <p id="errorMessage"></p>
                    <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-primary" onclick="loadData()">
                            <i class="fas fa-redo"></i> –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                        </button>
                    </div>
                </div>

                <div class="table-wrapper" id="tableWrapper" style="display: none;">
                    <table>
                        <thead>
                            <tr>
                                <th>–¢–æ–≤–∞—Ä</th>
                                <th>–ê—Ä—Ç–∏–∫—É–ª</th>
                                <th>–ó–∞–∫–∞–∑–∞–Ω–æ (30 –¥–Ω.)</th>
                                <th>–û—Å—Ç–∞—Ç–∫–∏ –í–ë</th>
                                <th>–û—Å—Ç–∞—Ç–∫–∏ –ú–ü</th>
                                <th>–ü—Ä–æ–¥–∞–∂/–¥–µ–Ω—å</th>
                                <th>–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å</th>
                                <th>–¢–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </tbody>
                    </table>
                </div>

                <div id="emptyState" class="empty-state">
                    <i class="fas fa-database"></i>
                    <h3>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
                    <p>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ", —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ Google –¢–∞–±–ª–∏—Ü—ã</p>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Warehouse Status -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-warehouse"></i> –°—Ç–∞—Ç—É—Å —Å–∫–ª–∞–¥–æ–≤</h3>
                        <div class="badge" id="updateTime">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                    <div class="warehouse-list" id="warehouseList">
                        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ —Å–∫–ª–∞–¥—ã -->
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <h3><i class="fas fa-cogs"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                    <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 12px;">
                        <button class="btn btn-outline" id="exportBtn">
                            <i class="fas fa-file-excel"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                        </button>
                        <button class="btn btn-secondary" id="calculateBtn">
                            <i class="fas fa-calculator"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–æ—Å—Ç–∞–≤–∫–∏
                        </button>
                    </div>
                </div>

                <!-- Action Card -->
                <div class="action-card">
                    <h3>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç</h3>
                    <button class="btn btn-primary" style="background: white; color: #667eea; width: 100%; margin-top: 15px;" id="autoCalculateBtn">
                        <i class="fas fa-bolt"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>Wildberries Analytics Dashboard</strong> ‚Ä¢ v3.0 ‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç —Å –≤–∞—à–µ–π Google –¢–∞–±–ª–∏—Ü–µ–π</p>
            <p style="margin-top: 5px; font-size: 12px; color: #666;">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç CORS –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞</p>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
        const CONFIG = {
            // –í–∞—à Google Apps Script URL (–Ω–µ –º–µ–Ω—è–π—Ç–µ!)
            SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbxg4Be2OPZvCbjLDUWzxjGBrRn0XzLZ7TF8sCGATiTmwJryJ0D8yS1LR1RKDaamg2xj/exec',
            
            // –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π CORS –ø—Ä–æ–∫—Å–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏)
            CORS_PROXY: 'https://api.allorigins.win/raw?url=',
            
            STOCK_THRESHOLDS: {
                CRITICAL: 5,
                LOW: 15,
                HIGH: 50
            },
            TURNOVER_THRESHOLDS: {
                FAST: 15,
                MEDIUM: 30,
                SLOW: 60
            },
            DAYS_THRESHOLDS: {
                URGENT: 7,
                WARNING: 14,
                GOOD: 30,
                EXCESS: 60
            }
        };

        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let productsData = [];
        let filteredData = [];

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        // ========== –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô ==========
        function setupEventListeners() {
            document.getElementById('loadDataBtn').addEventListener('click', loadData);
            document.getElementById('searchInput').addEventListener('input', function(e) {
                filterProducts(e.target.value);
            });
            document.getElementById('exportBtn').addEventListener('click', exportToExcel);
            document.getElementById('calculateBtn').addEventListener('click', calculateSupplies);
            document.getElementById('autoCalculateBtn').addEventListener('click', calculateSupplies);
        }

        // ========== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ==========
        async function loadData() {
            showLoading('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CORS –ø—Ä–æ–∫—Å–∏...');
            hideError();
            
            try {
                // –°–æ–∑–¥–∞–µ–º URL —á–µ—Ä–µ–∑ CORS –ø—Ä–æ–∫—Å–∏
                const url = `${CONFIG.CORS_PROXY}${encodeURIComponent(CONFIG.SCRIPT_URL + '?action=getData&t=' + Date.now())}`;
                console.log('–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏:', url);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                console.log('–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω:', response.status);
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', result);
                
                if (result.success && result.data && result.data.length > 0) {
                    processData(result.data);
                    updateUI();
                    showTable();
                    showSuccess('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                } else if (result.success && (!result.data || result.data.length === 0)) {
                    showEmptyState('–í —Ç–∞–±–ª–∏—Ü–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ Google –¢–∞–±–ª–∏—Ü–µ.');
                } else {
                    throw new Error(result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                
                // –ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º –Ω–∞–ø—Ä—è–º—É—é (–¥–ª—è —Ç–µ—Å—Ç–∞)
                if (error.message.includes('–ø—Ä–æ–∫—Å–∏')) {
                    try {
                        showLoading('–ü—Ä–æ–±—É–µ–º –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
                        await testDirectConnection();
                        return;
                    } catch (directError) {
                        showError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}. –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.`);
                    }
                } else {
                    showError(`–û—à–∏–±–∫–∞: ${error.message}`);
                }
                
                clearData();
            } finally {
                hideLoading();
            }
        }

        // ========== –¢–ï–°–¢ –ü–†–Ø–ú–û–ì–û –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø ==========
        async function testDirectConnection() {
            try {
                const testUrl = CONFIG.SCRIPT_URL + '?action=test&t=' + Date.now();
                console.log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:', testUrl);
                
                const response = await fetch(testUrl, {
                    method: 'GET',
                    mode: 'no-cors' // –†–µ–∂–∏–º no-cors –¥–ª—è —Ç–µ—Å—Ç–∞
                });
                
                // –í —Ä–µ–∂–∏–º–µ no-cors –º—ã –Ω–µ –º–æ–∂–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç, —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
                console.log('–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                showError(`
                    <strong>–ü—Ä–æ–±–ª–µ–º–∞ —Å CORS!</strong><br><br>
                    –ß—Ç–æ–±—ã —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É:<br>
                    1. <strong>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç HTML —Ñ–∞–π–ª –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥</strong> (GitHub Pages, Vercel, Netlify)<br>
                    2. –ò–ª–∏ <strong>–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä</strong>:<br>
                    &nbsp;&nbsp;- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python<br>
                    &nbsp;&nbsp;- –í –ø–∞–ø–∫–µ —Å —Ñ–∞–π–ª–æ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: <code>python -m http.server 8000</code><br>
                    &nbsp;&nbsp;- –û—Ç–∫—Ä–æ–π—Ç–µ <a href="http://localhost:8000" target="_blank">http://localhost:8000</a>
                `);
                
            } catch (error) {
                throw error;
            }
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –î–ê–ù–ù–´–• ==========
        function processData(data) {
            console.log('–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ:', data);
            
            productsData = data.map((item, index) => {
                const product = {
                    id: index + 1,
                    name: item.name || item.supplierArticle || item['–ê—Ä—Ç–∏–∫—É–ª –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞'] || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                    nmId: item.nmId || item.article || item['nmId'] || '',
                    ordered: parseFloat(item.ordered || item.orderedQty || item['–ó–∞–∫–∞–∑–∞–Ω–æ —à—Ç (30 –¥–Ω–µ–π)'] || 0),
                    wbStock: parseFloat(item.wbStock || item['–û—Å—Ç–∞—Ç–∫–∏ –í–ë'] || 0),
                    mpStock: parseFloat(item.mpStock || item.myStock || item['–û—Å—Ç–∞—Ç–∫–∏ –ú–ü'] || 0),
                    avgPerDay: parseFloat(item.avgPerDay || item.avgOrdersPerDay || item['–°—Ä–µ–¥–Ω–µ–µ –ø—Ä–æ–¥–∞–∂ –≤ –¥–µ–Ω—å'] || 0),
                    turnover: parseFloat(item.turnover || item['–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å (–¥–Ω–µ–π)'] || 0),
                    reorderPoint: parseFloat(item.reorderPoint || item['–¢–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞'] || 0)
                };
                
                product.totalStock = product.wbStock + product.mpStock;
                product.daysOfSupply = product.avgPerDay > 0 ? 
                    Math.round(product.totalStock / product.avgPerDay) : 
                    (product.totalStock > 0 ? 999 : 0);
                product.status = getProductStatus(product);
                
                return product;
            }).filter(product => product.name && product.name !== '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è');
            
            console.log('–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã:', productsData.length);
            
            filteredData = [...productsData];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
            const now = new Date();
            document.getElementById('updateTime').textContent = 
                `${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Å–∫–ª–∞–¥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–≤–∞—Ä–æ–≤
            generateWarehouseData();
        }

        // ========== –ì–ï–ù–ï–†–ê–¶–ò–Ø –î–ê–ù–ù–´–• –°–ö–õ–ê–î–û–í ==========
        function generateWarehouseData() {
            const warehouseList = document.getElementById('warehouseList');
            
            if (productsData.length === 0) {
                warehouseList.innerHTML = '<div class="warehouse-item"><div class="warehouse-info"><div class="name">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div></div></div>';
                return;
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ "—Å–∫–ª–∞–¥–∞–º" –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
            const totalStock = productsData.reduce((sum, p) => sum + p.wbStock, 0);
            const avgStockPerWarehouse = Math.floor(totalStock / 8);
            
            const warehouses = [
                { name: '–®–∞–≥. 189', base: avgStockPerWarehouse * 2 },
                { name: '–®–∞–≥. 461', base: avgStockPerWarehouse * 1.5 },
                { name: '–®–∞–≥. 308', base: avgStockPerWarehouse },
                { name: '–®–∞–≥. 114', base: Math.floor(avgStockPerWarehouse * 0.8) },
                { name: '–®–∞–≥. 071', base: Math.floor(avgStockPerWarehouse * 0.5) },
                { name: '–®–∞–≥. 428', base: Math.floor(avgStockPerWarehouse * 0.3) },
                { name: '–®–∞–≥. 138', base: Math.floor(avgStockPerWarehouse * 0.2) },
                { name: '–®–∞–≥. 146', base: Math.floor(avgStockPerWarehouse * 0.1) }
            ];
            
            warehouseList.innerHTML = warehouses.map(wh => {
                const trend = Math.random() > 0.5 ? 'up' : 'down';
                const change = Math.floor(Math.random() * 10) + 1;
                const days = Math.floor(Math.random() * 10) + 1;
                
                return `
                    <div class="warehouse-item">
                        <div class="warehouse-info">
                            <div class="name">${wh.name}</div>
                            <div class="days">${days} –¥–Ω. –∑–∞–ø–∞—Å–∞</div>
                        </div>
                        <div class="warehouse-stats">
                            <div class="stock">${wh.base} —à—Ç</div>
                            <div class="trend ${trend}">${trend === 'up' ? '‚Üë' : '‚Üì'} ${change}%</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï–ú ==========
        function showTable() {
            document.getElementById('tableWrapper').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('errorState').style.display = 'none';
        }

        function showEmptyState(message) {
            const emptyState = document.getElementById('emptyState');
            emptyState.innerHTML = `
                <i class="fas fa-database"></i>
                <h3>${message || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è'}</h3>
                <p>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ", —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</p>
            `;
            emptyState.style.display = 'block';
            document.getElementById('tableWrapper').style.display = 'none';
            document.getElementById('errorState').style.display = 'none';
        }

        function showError(message) {
            const errorState = document.getElementById('errorState');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.innerHTML = message;
            errorState.style.display = 'block';
            document.getElementById('tableWrapper').style.display = 'none';
            document.getElementById('emptyState').style.display = 'none';
        }

        function hideError() {
            document.getElementById('errorState').style.display = 'none';
        }

        function showSuccess(message) {
            console.log('‚úÖ ' + message);
        }

        // ========== –û–ß–ò–°–¢–ö–ê –î–ê–ù–ù–´–• ==========
        function clearData() {
            productsData = [];
            filteredData = [];
            updateUI();
        }

        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê ==========
        function updateUI() {
            updateStats();
            updateTable();
            updateAccountInfo();
        }

        function updateStats() {
            if (productsData.length === 0) {
                document.getElementById('totalProducts').textContent = '0';
                document.getElementById('totalStock').textContent = '0 —à—Ç';
                document.getElementById('totalOrders').textContent = '0';
                document.getElementById('avgTurnover').textContent = '0 –¥–Ω.';
                return;
            }
            
            const totalProducts = productsData.length;
            const totalStock = productsData.reduce((sum, p) => sum + p.totalStock, 0);
            const totalOrders = productsData.reduce((sum, p) => sum + p.ordered, 0);
            const avgTurnover = productsData.reduce((sum, p) => sum + p.turnover, 0) / totalProducts;
            
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalStock').textContent = `${totalStock} —à—Ç`;
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('avgTurnover').textContent = `${avgTurnover.toFixed(1)} –¥–Ω.`;
        }

        function updateTable() {
            const tableBody = document.getElementById('productsTable');
            
            tableBody.innerHTML = productsData.map(product => `
                <tr>
                    <td><strong>${escapeHtml(product.name)}</strong></td>
                    <td><code>${product.nmId}</code></td>
                    <td><strong>${product.ordered}</strong></td>
                    <td>
                        <span class="stock-badge ${getStockClass(product.wbStock)}">
                            ${product.wbStock} —à—Ç
                        </span>
                    </td>
                    <td>${product.mpStock} —à—Ç</td>
                    <td><strong>${product.avgPerDay.toFixed(2)}</strong></td>
                    <td>
                        <span class="turnover-badge ${getTurnoverClass(product.turnover)}">
                            ${product.turnover.toFixed(1)} –¥–Ω.
                        </span>
                    </td>
                    <td><strong style="color: ${product.reorderPoint > 0 ? '#dc3545' : '#28a745'}">
                        ${product.reorderPoint}
                    </strong></td>
                    <td>
                        <span class="days-badge ${getDaysClass(product.daysOfSupply)}">
                            ${product.daysOfSupply === 999 ? '‚àû' : product.daysOfSupply} –¥–Ω.
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        function updateAccountInfo() {
            const accountStats = document.getElementById('accountStats');
            
            if (productsData.length > 0) {
                const urgentCount = productsData.filter(p => p.status === 'urgent').length;
                accountStats.innerHTML = `${productsData.length} –ø–æ–∑–∏—Ü–∏–π ‚Ä¢ ${urgentCount} —Å—Ä–æ—á–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤`;
            } else {
                accountStats.innerHTML = '–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"';
            }
        }

        // ========== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ==========
        function filterProducts(searchTerm) {
            if (!searchTerm.trim()) {
                filteredData = [...productsData];
            } else {
                const term = searchTerm.toLowerCase();
                filteredData = productsData.filter(product =>
                    product.name.toLowerCase().includes(term) ||
                    (product.nmId && product.nmId.toString().toLowerCase().includes(term))
                );
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const tableBody = document.getElementById('productsTable');
            
            if (filteredData.length === 0) {
                showEmptyState('–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É: "' + searchTerm + '"');
                return;
            }
            
            tableBody.innerHTML = filteredData.map(product => `
                <tr>
                    <td><strong>${escapeHtml(product.name)}</strong></td>
                    <td><code>${product.nmId}</code></td>
                    <td><strong>${product.ordered}</strong></td>
                    <td>
                        <span class="stock-badge ${getStockClass(product.wbStock)}">
                            ${product.wbStock} —à—Ç
                        </span>
                    </td>
                    <td>${product.mpStock} —à—Ç</td>
                    <td><strong>${product.avgPerDay.toFixed(2)}</strong></td>
                    <td>
                        <span class="turnover-badge ${getTurnoverClass(product.turnover)}">
                            ${product.turnover.toFixed(1)} –¥–Ω.
                        </span>
                    </td>
                    <td><strong style="color: ${product.reorderPoint > 0 ? '#dc3545' : '#28a745'}">
                        ${product.reorderPoint}
                    </strong></td>
                    <td>
                        <span class="days-badge ${getDaysClass(product.daysOfSupply)}">
                            ${product.daysOfSupply === 999 ? '‚àû' : product.daysOfSupply} –¥–Ω.
                        </span>
                    </td>
                </tr>
            `).join('');
            
            showTable();
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function getProductStatus(product) {
            const days = product.daysOfSupply;
            if (days === 0 || (product.wbStock === 0 && product.mpStock === 0)) return 'urgent';
            if (days <= CONFIG.DAYS_THRESHOLDS.URGENT) return 'urgent';
            if (days <= CONFIG.DAYS_THRESHOLDS.WARNING) return 'warning';
            if (days <= CONFIG.DAYS_THRESHOLDS.GOOD) return 'good';
            return 'excess';
        }

        function getStockClass(stock) {
            if (stock === 0) return 'stock-critical';
            if (stock <= CONFIG.STOCK_THRESHOLDS.CRITICAL) return 'stock-critical';
            if (stock <= CONFIG.STOCK_THRESHOLDS.LOW) return 'stock-low';
            if (stock >= CONFIG.STOCK_THRESHOLDS.HIGH) return 'stock-high';
            return 'stock-normal';
        }

        function getTurnoverClass(turnover) {
            if (turnover <= CONFIG.TURNOVER_THRESHOLDS.FAST) return 'turnover-fast';
            if (turnover <= CONFIG.TURNOVER_THRESHOLDS.MEDIUM) return 'turnover-medium';
            return 'turnover-slow';
        }

        function getDaysClass(days) {
            if (days === 0 || days === 999) return 'days-urgent';
            if (days <= CONFIG.DAYS_THRESHOLDS.URGENT) return 'days-urgent';
            if (days <= CONFIG.DAYS_THRESHOLDS.WARNING) return 'days-warning';
            if (days <= CONFIG.DAYS_THRESHOLDS.GOOD) return 'days-good';
            return 'days-excess';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ========== –≠–ö–°–ü–û–†–¢ ==========
        function exportToExcel() {
            if (productsData.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞. –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ.');
                return;
            }
            
            const data = filteredData.length > 0 ? filteredData : productsData;
            const headers = ['–¢–æ–≤–∞—Ä', '–ê—Ä—Ç–∏–∫—É–ª', '–ó–∞–∫–∞–∑–∞–Ω–æ (30 –¥–Ω.)', '–û—Å—Ç–∞—Ç–∫–∏ –í–ë', '–û—Å—Ç–∞—Ç–∫–∏ –ú–ü', '–ü—Ä–æ–¥–∞–∂/–¥–µ–Ω—å', '–û–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç—å', '–¢–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞', '–î–Ω–µ–π –∑–∞–ø–∞—Å–∞'];
            const rows = data.map(p => [
                p.name,
                p.nmId,
                p.ordered,
                p.wbStock,
                p.mpStock,
                p.avgPerDay.toFixed(2),
                p.turnover.toFixed(1),
                p.reorderPoint,
                p.daysOfSupply === 999 ? '‚àû' : p.daysOfSupply
            ]);
            
            const csvContent = [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `wildberries_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV —Ñ–∞–π–ª');
        }

        // ========== –†–ê–°–ß–Å–¢ –ü–û–°–¢–ê–í–û–ö ==========
        function calculateSupplies() {
            if (productsData.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ.');
                return;
            }
            
            const urgentProducts = productsData.filter(p => p.status === 'urgent');
            const warningProducts = productsData.filter(p => p.status === 'warning');
            
            let message = 'üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ—Å—Ç–∞–≤–∫–∞–º:\n\n';
            
            if (urgentProducts.length > 0) {
                message += `üö® –°–†–û–ß–ù–û –ó–ê–ö–ê–ó–ê–¢–¨ (${urgentProducts.length} —Ç–æ–≤–∞—Ä–æ–≤):\n`;
                urgentProducts.forEach(p => {
                    message += `‚Ä¢ ${p.name}: ${p.reorderPoint} —à—Ç (–æ—Å—Ç–∞–ª–æ—Å—å ${p.totalStock} —à—Ç)\n`;
                });
                message += '\n';
            }
            
            if (warningProducts.length > 0) {
                message += `‚ö†Ô∏è  –°–ö–û–†–û –ó–ê–ö–ê–ó–´–í–ê–¢–¨ (${warningProducts.length} —Ç–æ–≤–∞—Ä–æ–≤):\n`;
                warningProducts.forEach(p => {
                    message += `‚Ä¢ ${p.name}: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º ${Math.ceil(p.avgPerDay * 7)} —à—Ç –Ω–∞ –Ω–µ–¥–µ–ª—é\n`;
                });
            }
            
            if (urgentProducts.length === 0 && warningProducts.length === 0) {
                message = '‚úÖ –í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–æ—Ä–º–µ. –°—Ä–æ—á–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.';
            }
            
            alert(message);
        }

        // ========== –£–¢–ò–õ–ò–¢–´ ==========
        function showLoading(message) {
            const overlay = document.getElementById('loadingOverlay');
            const text = document.getElementById('loadingText');
            text.textContent = message;
            overlay.style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
    </script>
</body>
</html>
